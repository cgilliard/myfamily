<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Family: base/chain_alloc.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Family
   </div>
   <div id="projectbrief">My Family</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_e914ee4d4a44400f1fdb170cb4ead18a.html">base</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">chain_alloc.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file contains definitions for the chain_allocator.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="slabs_8h_source.html">base/slabs.h</a>&gt;</code><br />
</div>
<p><a href="chain__alloc_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structChainGuardNc.html">ChainGuardNc</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a9a8623cb74a147abf95752a87e262c09"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chain__alloc_8h.html#a9a8623cb74a147abf95752a87e262c09">ChainGuard</a>&#160;&#160;&#160;<a class="el" href="structChainGuardNc.html">ChainGuardNc</a> <a class="el" href="types_8c.html#afd02bb0f6a745c39d5e3417493995c71">__attribute__</a>((warn_unused_result, cleanup(<a class="el" href="chain__alloc_8h.html#a849afb2f6a8c5640494bf4965c5ab07c">chain_guard_cleanup</a>)))</td></tr>
<tr class="separator:a9a8623cb74a147abf95752a87e262c09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a396e07a139256b7a3968b20e04f83537"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chain__alloc_8h.html#a396e07a139256b7a3968b20e04f83537">sync_allocator</a>()</td></tr>
<tr class="separator:a396e07a139256b7a3968b20e04f83537"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a51510a42e5821eac009d7b72fe88904a"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structChainGuardNc.html">ChainGuardNc</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chain__alloc_8h.html#a51510a42e5821eac009d7b72fe88904a">ChainGuardNc</a></td></tr>
<tr class="separator:a51510a42e5821eac009d7b72fe88904a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a849afb2f6a8c5640494bf4965c5ab07c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chain__alloc_8h.html#a849afb2f6a8c5640494bf4965c5ab07c">chain_guard_cleanup</a> (<a class="el" href="structChainGuardNc.html">ChainGuardNc</a> *ptr)</td></tr>
<tr class="separator:a849afb2f6a8c5640494bf4965c5ab07c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabfc2c8286d9abaf9668fb459e9516ea"><td class="memItemLeft" align="right" valign="top"><a class="el" href="chain__alloc_8h.html#a9a8623cb74a147abf95752a87e262c09">ChainGuard</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chain__alloc_8h.html#aabfc2c8286d9abaf9668fb459e9516ea">set_slab_allocator</a> (<a class="el" href="slabs_8h.html#a2cd1abc2fc8e5589968a3d0b5e41252d">SlabAllocator</a> *sa, <a class="el" href="types_8h.html#abb452686968e48b67397da5f97445f5b">bool</a> is_sync)</td></tr>
<tr class="separator:aabfc2c8286d9abaf9668fb459e9516ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a337698d87c79c3c56f2e8d9f5db24214"><td class="memItemLeft" align="right" valign="top"><a class="el" href="slabs_8h.html#a2cd1abc2fc8e5589968a3d0b5e41252d">SlabAllocator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chain__alloc_8h.html#a337698d87c79c3c56f2e8d9f5db24214">get_global_sync_allocator</a> ()</td></tr>
<tr class="separator:a337698d87c79c3c56f2e8d9f5db24214"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b4433e7d057a87fdf1fa33006dc6d43"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chain__alloc_8h.html#a6b4433e7d057a87fdf1fa33006dc6d43">chain_malloc</a> (<a class="el" href="structFatPtr.html">FatPtr</a> *ptr, <a class="el" href="types_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> size)</td></tr>
<tr class="separator:a6b4433e7d057a87fdf1fa33006dc6d43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9dd3abfb5b8753750b5ce0b1caaf3fc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chain__alloc_8h.html#af9dd3abfb5b8753750b5ce0b1caaf3fc">chain_realloc</a> (<a class="el" href="structFatPtr.html">FatPtr</a> *ptr, <a class="el" href="types_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> size)</td></tr>
<tr class="separator:af9dd3abfb5b8753750b5ce0b1caaf3fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a513147aea9921ee84d3b49cd5af9e4af"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="chain__alloc_8h.html#a513147aea9921ee84d3b49cd5af9e4af">chain_free</a> (<a class="el" href="structFatPtr.html">FatPtr</a> *ptr)</td></tr>
<tr class="separator:a513147aea9921ee84d3b49cd5af9e4af"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains definitions for the chain_allocator. </p>
<h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p>The chain allocator is a data structure which allows for chaining of the <a class="el" href="slabs_8h.html#a2cd1abc2fc8e5589968a3d0b5e41252d">SlabAllocator</a> structure. These slab allocators can be added to the chain and when the scope that they were added in ends, they are automatically removed from the chain and the previous chain allocator becomes active once again. The purpose is to allow for scope specific slab allocator. This allows data structures to use a specific slab allocator during their function calls.</p>
<p>For instance, I might have a Queue data type which has a synchronized configuration parameter. If synchronized is false, the Queue can use the default thread local slab allocator to allocate memory. However, if the queue is meant to be thread safe, the Queue may want to have either a global synchornized SlabAllocator or a custom SlabAllocator that is only used for this Queue. All these options are possible with the chain allocator and additionally, the previous stack of slab allocators is restored after the Queue's functions end. This is accomplished with the 'ChainGuard' type and its <b>attribute</b> cleanup functon which automatically restores state when the guard goes out of scope. So, let's say my Queue is configured to use a synchronized slab allocator, the queue can use it in it's function call simply by calling: ChainGuard guard = chain_guard_init(sync_slabs, true); Then, when this guard goes out of scope (at the end of the Queue's function call), the previous SlabAllocator is restored. If no additional slab allocators are left, the default slab allocator remains. This way a data type can use a memory allocation method that meets its requirements without having an effect on calling data types or data types it calls itself. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a9a8623cb74a147abf95752a87e262c09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a8623cb74a147abf95752a87e262c09">&#9670;&nbsp;</a></span>ChainGuard</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ChainGuard&#160;&#160;&#160;<a class="el" href="structChainGuardNc.html">ChainGuardNc</a> <a class="el" href="types_8c.html#afd02bb0f6a745c39d5e3417493995c71">__attribute__</a>((warn_unused_result, cleanup(<a class="el" href="chain__alloc_8h.html#a849afb2f6a8c5640494bf4965c5ab07c">chain_guard_cleanup</a>)))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a396e07a139256b7a3968b20e04f83537"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a396e07a139256b7a3968b20e04f83537">&#9670;&nbsp;</a></span>sync_allocator</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define sync_allocator</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    ({                                                                                             \</div>
<div class="line">        SlabAllocatorNc *__sync_alloc_ = <a class="code" href="chain__alloc_8h.html#a337698d87c79c3c56f2e8d9f5db24214">get_global_sync_allocator</a>();                              \</div>
<div class="line">        ChainGuardNc __ret_ = <a class="code" href="chain__alloc_8h.html#aabfc2c8286d9abaf9668fb459e9516ea">set_slab_allocator</a>(__sync_alloc_, <span class="keyword">true</span>);                             \</div>
<div class="line">        __ret_;                                                                                    \</div>
<div class="line">    })</div>
<div class="ttc" id="achain__alloc_8h_html_a337698d87c79c3c56f2e8d9f5db24214"><div class="ttname"><a href="chain__alloc_8h.html#a337698d87c79c3c56f2e8d9f5db24214">get_global_sync_allocator</a></div><div class="ttdeci">SlabAllocator * get_global_sync_allocator()</div><div class="ttdef"><b>Definition:</b> chain_alloc.c:66</div></div>
<div class="ttc" id="achain__alloc_8h_html_aabfc2c8286d9abaf9668fb459e9516ea"><div class="ttname"><a href="chain__alloc_8h.html#aabfc2c8286d9abaf9668fb459e9516ea">set_slab_allocator</a></div><div class="ttdeci">ChainGuard set_slab_allocator(SlabAllocator *sa, bool is_sync)</div><div class="ttdef"><b>Definition:</b> chain_alloc.c:114</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a51510a42e5821eac009d7b72fe88904a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51510a42e5821eac009d7b72fe88904a">&#9670;&nbsp;</a></span>ChainGuardNc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structChainGuardNc.html">ChainGuardNc</a> <a class="el" href="structChainGuardNc.html">ChainGuardNc</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a513147aea9921ee84d3b49cd5af9e4af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a513147aea9921ee84d3b49cd5af9e4af">&#9670;&nbsp;</a></span>chain_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chain_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFatPtr.html">FatPtr</a> *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a849afb2f6a8c5640494bf4965c5ab07c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a849afb2f6a8c5640494bf4965c5ab07c">&#9670;&nbsp;</a></span>chain_guard_cleanup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void chain_guard_cleanup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structChainGuardNc.html">ChainGuardNc</a> *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6b4433e7d057a87fdf1fa33006dc6d43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b4433e7d057a87fdf1fa33006dc6d43">&#9670;&nbsp;</a></span>chain_malloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int chain_malloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFatPtr.html">FatPtr</a> *&#160;</td>
          <td class="paramname"><em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af9dd3abfb5b8753750b5ce0b1caaf3fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9dd3abfb5b8753750b5ce0b1caaf3fc">&#9670;&nbsp;</a></span>chain_realloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int chain_realloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFatPtr.html">FatPtr</a> *&#160;</td>
          <td class="paramname"><em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a337698d87c79c3c56f2e8d9f5db24214"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a337698d87c79c3c56f2e8d9f5db24214">&#9670;&nbsp;</a></span>get_global_sync_allocator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="slabs_8h.html#a2cd1abc2fc8e5589968a3d0b5e41252d">SlabAllocator</a>* get_global_sync_allocator </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aabfc2c8286d9abaf9668fb459e9516ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabfc2c8286d9abaf9668fb459e9516ea">&#9670;&nbsp;</a></span>set_slab_allocator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="chain__alloc_8h.html#a9a8623cb74a147abf95752a87e262c09">ChainGuard</a> set_slab_allocator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="slabs_8h.html#a2cd1abc2fc8e5589968a3d0b5e41252d">SlabAllocator</a> *&#160;</td>
          <td class="paramname"><em>sa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#abb452686968e48b67397da5f97445f5b">bool</a>&#160;</td>
          <td class="paramname"><em>is_sync</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
